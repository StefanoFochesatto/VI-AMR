# VI-AMR/examples/glacier/

Remember to activate the Firedrake virtual environment.

## synthetic examples

### illustrations

To run a default steady-state glacier simulation for a synthetic glacier do
```
python3 steady.py
```
or for an interesting case with Paraview-readable output,
```
python3 steady.py -prob cap -elevdepend -sELA 900 -m 20 -refine 4 -uniform 1 -opvd result_cap.pvd
```

### convergence and AMR efficiency

In the paper there is an example showing norm and geometrical errors against mesh complexity (number of elements).  Uniform, UDO+GR, and VCD+GR mesh refinement methods are shown.  Here are these runs:
```
mpiexec -n 12 python3 steady.py -newton -m 5 -refine 8 -uniform 8 -csv uniform.csv
mpiexec -n 12 python3 steady.py -newton -m 5 -refine 13 -csv udo.csv
mpiexec -n 12 python3 steady.py -newton -m 5 -refine 13 -vcd -csv vcd.csv
```


## an example which uses data for bed topography

The NetCDF file `eastgr.nc` is already present.  It contains the ice-free bed topography for a portion of eastern Greenland, on a relatively low-resolution 5 km quadrilateral mesh.

To [read NetCDF files](https://unidata.github.io/netcdf4-python/) do
```
pip install netCDF4
```
Then do
```
python3 steady.py -data eastgr.nc
```

### re-generating the NetCDF file

The file `eastgr.nc` _can be regenerated by_ cloning [PISM](https://github.com/pism/pism/) and using [NCO](https://nco.sourceforge.net/):
```
git clone https://github.com/pism/pism.git
sudo apt install nco
```
Now do the following:
```
cd pism/examples/std-greenland/
bash preprocess.sh   # downloads data; requires wget and the NCO
                     # generates pism_Greenland_5km_v1.1.nc
ncks -O -d x1,0.0,700.0e3 -d y1,-2.7e6,-1.3e6 -v topg pism_Greenland_5km_v1.1.nc eastgr.nc
```
One can view NetCDF files directly with [`ncview`](https://cirrus.ucsd.edu/ncview/).  I use the Debian packages for NCO and `ncview`.
